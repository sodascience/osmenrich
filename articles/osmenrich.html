<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to osmenrich • osmenrich</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to osmenrich">
<meta property="og:description" content="Learn how OSMenrich works, and how you can  customise it.
">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-NEMHDHYTS8"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NEMHDHYTS8');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">osmenrich</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/osmenrich.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sodascience/osmenrich">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="osmenrich_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to osmenrich</h1>
                        <h4 class="author">SoDa Team</h4>
            
      
      
      <div class="hidden name"><code>osmenrich.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">osmenrich</span><span class="op">)</span></code></pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>osmenrich</code> is an R package to easily enrich geocoded data (latitude/longitude) with geographic features from OpenStreetMap (OSM). This package is designed to work with the <a href="https://r-spatial.github.io/sf/articles/sf1.html"><code>sf</code></a> and <a href="https://cran.r-project.org/web/packages/osmdata/vignettes/osmdata.html"><code>osmdata</code></a> packages. This package leverages the work provided in <code>sf</code> for the manipulation of simple features (i.e. real-world objects), and <code>osmdata</code> for querying OpenStreetMap data (i.e. geographical data).</p>
<p>This vignette:</p>
<ul>
<li>Explains the basic functioning of the package</li>
<li>Shows how to use the package</li>
<li>Explains the differences of use cases of this package</li>
<li>Directs the user to the right use case for more examples</li>
</ul>
</div>
<div id="how-does-osmenrich-work" class="section level2">
<h2 class="hasAnchor">
<a href="#how-does-osmenrich-work" class="anchor"></a>How does <code>osmenrich</code> work?</h2>
<p>Often a user is interested in retrieving information about the location and the closeness of real-world objects. If the objects in a dataset have geocoded data (latitude/longitude), then this package enables the user to interact with these objects and enrich them with information about other objects around them. We call the object in the dataset " <em>reference points</em> “, while the objects we are interested in retrieving” <em>feature points</em> ".</p>
<p>Therefore, if a dataset contains geocoded data, with this package one can extract information about real-world object around each of the objects contained in the data, compute their distance/duration from the objects and then enrich the dataset with this information. The result is a tidy <code>sf</code> dataset.</p>
<p>To do this, the package needs to connect to a server containing OpenStreetMap data and one (or more) servers containing routing engines - used to compute durations and distances.</p>
</div>
<div id="how-to-use-osmenrich" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-use-osmenrich" class="anchor"></a>How to use <code>osmenrich</code>
</h2>
<p><code>osmenrich</code> can be installed with the remotes package from GitHub with</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"sodascience/osmenrich"</span><span class="op">)</span></code></pre></div>
<p>and then load it in the usual way:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">osmenrich</span><span class="op">)</span></code></pre></div>
<p>Out of the box <code>osmenrich</code> uses pubic remote servers to retrieve OSM data and to compute distances/durations from <em>reference points</em> to <em>feature points</em></p>
<div id="use-of-remote-and-local-servers" class="section level3">
<h3 class="hasAnchor">
<a href="#use-of-remote-and-local-servers" class="anchor"></a>Use of remote and local servers</h3>
<p>As stated above, <code>osmenrich</code> makes use of an OSM server and one or more OSRM servers to retrieve OSM data ( <em>feature points</em> ) and to calculate metrics such as distances and durations. The OSM <em>feature points</em> available can be found by: 1. Visiting the OSM wiki: <a href="https://wiki.openstreetmap.org/wiki/Map_features" class="uri">https://wiki.openstreetmap.org/wiki/Map_features</a> 2. Loading the <code>osmdata</code> (<code><a href="https://docs.ropensci.org/osmdata/">library(osmdata)</a></code>) and calling the function <code>available_features()</code> and <code>available_tags()</code></p>
<p>The basic data enrichment will work without having to setup any one of these server locally, thanks to publicly available servers. However, for large data enrichment tasks and for tasks involving the computation of durations between <em>reference points</em> and <em>feature points</em> and/or the computation of custom distances or durations between these points (such as the distances between two points computed on a walking distance or cycling), the setup of one or more of these servers is required.</p>
<p>We created a <a href="https://github.com/sodascience/osmenrich_docker">GitHub repository</a> hosting the instruction and the <code>docker_compose.yml</code> files needed to setup these servers.</p>
</div>
</div>
<div id="package-use-cases" class="section level2">
<h2 class="hasAnchor">
<a href="#package-use-cases" class="anchor"></a>Package use cases</h2>
<p>To facilitate the routing of users to the right setup for their need, we provide some use cases and their respective recommended setup:</p>
<ul>
<li>
<strong>Base Example</strong> <em>Target use-case</em>: the user only wants to enrich adding nearby features. The user is not interested in distances nor durations as measured by OSRM servers.
<ul>
<li>
<em>Size of data to be requested</em>: limited</li>
<li>
<em>Setup servers via Docker</em>: not necessary. The connection relies on public servers.</li>
<li>
<em>Link to example</em>: <a href="#basexample">Basic Example</a>
</li>
</ul>
</li>
<li>
<strong>Normal Example</strong> <em>Target use-case</em>: the user only wants to enrich adding features for a large area. The user might be interested in distances but does not require a specific metric (i.e. car vs. foot vs. bike)
<ul>
<li>
<em>Size of data to be requested</em>: theoretically unlimited</li>
<li>
<em>Setup servers via Docker</em>: setup only the <code>overpass</code> (OSM) server. The OSRM connection will rely on public servers (only car distances available!)</li>
<li>
<em>Link to example</em>: <a href="#normalexample">Normal Example</a>
</li>
</ul>
</li>
<li>
<strong>Advanced Example</strong>
<ul>
<li>
<em>Target use-case</em>: the user wants to enrich adding features for a large area and/or is interested in specific metrics for distances/durations (i.e. foot or bike)</li>
<li>
<em>Size of data to be requested</em>: theoretically unlimited</li>
<li>
<em>Setup servers via Docker</em>: use the <code>docker_compose.yml</code> to setup both the <code>overpass</code> (OSM) and all three <code>OSRM</code> servers.</li>
<li>
<em>Link to example</em>: <a href="#todo">Advanced Example</a>
</li>
</ul>
</li>
</ul>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<div id="basexample" class="section level3">
<h3 class="hasAnchor">
<a href="#basexample" class="anchor"></a>Base Example</h3>
<p>Let’s enrich a spatial (<code>sf</code>) dataset (<code>sf_example</code>) with the number of waste baskets in a radius of 100 meters from each of the point specified in a dataset:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Import libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">osmenrich</span><span class="op">)</span>

<span class="co"># Create an example dataset to enrich</span>
<span class="va">sf_example</span> <span class="op">&lt;-</span>
  <span class="fu">tribble</span><span class="op">(</span>
    <span class="op">~</span><span class="va">person</span>, <span class="op">~</span><span class="va">id</span>,  <span class="op">~</span><span class="va">lat</span>,  <span class="op">~</span><span class="va">lon</span>, <span class="op">~</span><span class="va">val</span>,
    <span class="st">"Alice"</span>,   <span class="fl">1</span>, <span class="fl">52.12</span>,  <span class="fl">5.09</span>,   <span class="fl">5L</span>,
    <span class="st">"Bob"</span>,     <span class="fl">2</span>, <span class="fl">52.13</span>,  <span class="fl">5.08</span>,   <span class="fl">2L</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>

<span class="co"># Print the tibble</span>
<span class="va">sf_example</span>
<span class="co"># &gt; Simple feature collection with 2 features and 3 fields</span>
<span class="co"># &gt; geometry type:  POINT</span>
<span class="co"># &gt; dimension:      XY</span>
<span class="co"># &gt; bbox:           xmin: 5.08 ymin: 52.12 xmax: 5.09 ymax: 52.13</span>
<span class="co"># &gt; CRS:            EPSG:4326</span>
<span class="co"># &gt; # A tibble: 2 x 4</span>
<span class="co"># &gt;  person    id   val     geometry</span>
<span class="co"># &gt; * &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt;  &lt;POINT [°]&gt;</span>
<span class="co"># &gt; 1 Alice      1     5 (5.09 52.12)</span>
<span class="co"># &gt; 2 Bob        2     2 (5.08 52.13)</span></code></pre></div>
<p>To enrich the <code>sf_example</code> dataset with “waste baskets” in a 100m radius, we create a query using the <code><a href="../reference/enrich.html">enrich_osm()</a></code> function. This function uses the bounding box created by the points present in the example dataset and searches for the specified <code>key = "amenity"</code> and <code>value = "waste_basket</code>. We also add a custom <code>name</code> for the newly created column and specify the radius (<code>r</code>) used in the search.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Simple OSMEnrich query</span>
<span class="va">sf_example_simple</span> <span class="op">&lt;-</span> <span class="va">sf_example</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"waste_baskets"</span>,
    key <span class="op">=</span> <span class="st">"amenity"</span>,
    value <span class="op">=</span> <span class="st">"waste_basket"</span>,
    r <span class="op">=</span> <span class="fl">100</span>
  <span class="op">)</span>
<span class="co"># &gt; Downloading data for waste_baskets... Done.</span>
<span class="co"># &gt; Downloaded 26 points, 0 lines, 0 polygons, 0 mlines, 0 mpolygons.</span>
<span class="co"># &gt; Computing distance matrix for wastebaskets...Done.</span>
<span class="co"># &gt; Adding waste_baskets to data.</span>

<span class="co"># Print the enriched tibble</span>
<span class="va">sf_example_simple</span>
<span class="co"># &gt; Simple feature collection with 2 features and 4 fields</span>
<span class="co"># &gt; geometry type:  POINT</span>
<span class="co"># &gt; dimension:      XY</span>
<span class="co"># &gt; bbox:           xmin: 5.08 ymin: 52.12 xmax: 5.09 ymax: 52.13</span>
<span class="co"># &gt; CRS:            EPSG:4326</span>
<span class="co"># &gt; # A tibble: 2 x 5</span>
<span class="co"># &gt;   person    id   val     geometry waste_baskets</span>
<span class="co"># &gt; * &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt;  &lt;POINT [°]&gt;         &lt;int&gt;</span>
<span class="co"># &gt; 1 Alice      1     5 (5.09 52.12)             3</span>
<span class="co"># &gt; 2 Bob        2     2 (5.08 52.13)             0</span></code></pre></div>
</div>
<div id="normalexample" class="section level3">
<h3 class="hasAnchor">
<a href="#normalexample" class="anchor"></a>Normal Example</h3>
</div>
<div id="advanced-enrichment-example" class="section level3">
<h3 class="hasAnchor">
<a href="#advanced-enrichment-example" class="anchor"></a>Advanced enrichment example</h3>
<p>Using the example dataset <code>sf_example</code> specified in the previous example, we continue with a more advanced enrichment example. Here, we use a number of additional available variables to specify our initial “waste_baskets” query. We add the following:</p>
<ul>
<li>
<code>type: "points"</code>: we specify that we are interested only in retrieving points from OSM. In this example there will not be a difference, however when querying different types of objects this might help us reduce the the amount of data retrieved.</li>
<li>
<code>distance: "distance_by_car"</code>: we are not anymore interested in just retrieving the number of points in a certain area (given by the radius <code>r</code>), but we now want to retrieve the sum of the driving distances from a point to all the waste_baskets within radius <code>r</code>.</li>
<li>
<code>kernel: "parabola"</code>: we can specify the kernel function used in summarizing the features retrieved (in this example waste_baskets). Kernels convert distance or duration vectors to single numbers, with a certain weight for certain distances. This package also support the usage of custom kernel functions.</li>
</ul>
<p>In this example, we make use of a local instance of the OSRM server to query the driving distances (<code>distance = "distance_by_car"</code>). Follow the instructions in section <a href="https://github.com/sodascience/osmenrich_docker">Osmenrich Docker repository</a> to set it up. Otherwise, out-of-the-box this package will support querying <strong>only</strong> driving distances. If you are interested in querying distances or durations for other means of transportation, you will need to set up local OSRM instances.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Specify the address of local OSRM instance</span>
<span class="co"># options(osrm.server = "http://localhost:&lt;port&gt;/")</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>osrm.server <span class="op">=</span> <span class="st">"http://localhost:8080/"</span><span class="op">)</span>
<span class="co"># You can specify also the address of the Overpass (OSM) instance</span>
<span class="co"># osmdata::set_overpass_url("http://localhost:&lt;port&gt;/api/interpreter")</span>
<span class="fu">osmdata</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/set_overpass_url.html">set_overpass_url</a></span><span class="op">(</span><span class="st">"http://localhost:8888/api/interpreter"</span><span class="op">)</span>

<span class="co"># Advanced OSMEnrich query</span>
<span class="va">sf_example_advanced</span> <span class="op">&lt;-</span> <span class="va">sf_example</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"waste_baskets"</span>,
    key <span class="op">=</span> <span class="st">"amenity"</span>,
    value <span class="op">=</span> <span class="st">"waste_basket"</span>,
    type <span class="op">=</span> <span class="st">"points"</span>,
    distance <span class="op">=</span> <span class="st">"distance_by_foot"</span>,
    kernel <span class="op">=</span> <span class="st">"uniform"</span>,
    r <span class="op">=</span> <span class="fl">100</span>
  <span class="op">)</span>

<span class="va">sf_example_advanced</span>
<span class="co"># &gt; Simple feature collection with 2 features and 4 fields</span>
<span class="co"># &gt; geometry type:  POINT</span>
<span class="co"># &gt; dimension:      XY</span>
<span class="co"># &gt; bbox:           xmin: 5.08 ymin: 52.12 xmax: 5.09 ymax: 52.13</span>
<span class="co"># &gt; CRS:            EPSG:4326</span>
<span class="co"># &gt; # A tibble: 2 x 5</span>
<span class="co"># &gt;   person    id   val     geometry waste_baskets</span>
<span class="co"># &gt; * &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt;  &lt;POINT [°]&gt;         &lt;int&gt;</span>
<span class="co"># &gt; 1 Alice      1     5 (5.09 52.12)             1</span>
<span class="co"># &gt; 2 Bob        2     2 (5.08 52.13)             0</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://erikjanvankesteren.nl/">Erik-Jan van Kesteren</a>, Leonardo Jaya Vida, Jonathan de Bruin, SoDa Team.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
