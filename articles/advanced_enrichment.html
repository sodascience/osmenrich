<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced enrichment with osmenrich • osmenrich</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Advanced enrichment with osmenrich">
<meta property="og:description" content="A tutorial to use osmenrich in a complex project.
">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">osmenrich</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/osmenrich.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sodascience/osmenrich">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="advanced_enrichment_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced enrichment with osmenrich</h1>
                        <h4 class="author">SoDa Team and <span class="citation">@vankesteren</span>
</h4>
            
      
      
      <div class="hidden name"><code>advanced_enrichment.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In this advanced example, you will go through the steps of an example project to enrich data relative to the position of features (shops and natural features) within the city of Utrecht to predict the nesting behavior of swifts.</p>
<div id="load-libraries" class="section level3">
<h3 class="hasAnchor">
<a href="#load-libraries" class="anchor"></a>Load libraries</h3>
<p>Libraries for data wrangling and enrichment:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">osmenrich</span><span class="op">)</span></code></pre></div>
<p>Libraries for modeling:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Modeling</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></code></pre></div>
<p>Libraries for plotting:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plotting</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/">ggspatial</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">firatheme</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/ggeffects/">ggeffects</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></code></pre></div>
<p>If you already followed the introductory tutorial, you will know that the <code>osmenrich</code> package offers the possibility of creating local instances of both the Overpass API, to serve an instance of OpenStreetMap (OSM) and of OSRM servers, to calculate the routing information.</p>
<p>If you already set up one of these options, you can set the connection variables running the following snippet (remember to change the port of the server(s) to your chosen one!):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Optional: use local version of osm</span>
<span class="co">#osmdata::set_overpass_url("http://localhost:8888/api/interpreter")</span>
<span class="co">#options("osrm.server" = "http://localhost:8080")</span></code></pre></div>
</div>
<div id="data-the-common-swift-in-utrecht" class="section level3">
<h3 class="hasAnchor">
<a href="#data-the-common-swift-in-utrecht" class="anchor"></a>Data: the common swift in Utrecht</h3>
<p>To demonstrate the usage of <code>osmenrich</code>, in this example you will use the dataset of swifts (a type of bird) provided openly by the municipality of Utrecht (The Netherlands).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_url</span> <span class="op">&lt;-</span> <span class="st">"https://ckan.dataplatform.nl/dataset/8ceaae10-fb90-4ec0-961c-ef02691bb861/resource/baae4cde-cf33-416b-aa4e-d0fba160eed9/download/gierzwaluwinventarisatie2014.csv"</span></code></pre></div>
<p>Once you downloaded the dataset, select only the relevant columns using the tidyverse syntax. In this example, you are interested in retrieving the <code>latitude</code> and <code>longitude</code> for each swift nest, and the number of nests (<code>nestcount</code>). You then need to convert the latitude and longitude coordinates to a spatial format using the <code>st_as_sf</code> from the <code>sf</code> package.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bird_sf</span> <span class="op">&lt;-</span>
  <span class="fu">read_csv</span><span class="op">(</span><span class="va">data_url</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">latitude</span>, <span class="va">longitude</span>, <span class="va">`aantal nesten`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span>nestcount <span class="op">=</span> <span class="st">"aantal nesten"</span>, <span class="va">geometry</span><span class="op">)</span></code></pre></div>
<p>To see how the swift data look like, you can plot the retrieved points using <code>ggplot</code>. The additional parameters are used to create a nice-looking plot but are not necessary for the creation of the map.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot data</span>
<span class="va">plot_bird</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">bird_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">nestcount</span>, size <span class="op">=</span> <span class="va">nestcount</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html">annotation_map_tile</a></span><span class="op">(</span>zoomin <span class="op">=</span> <span class="fl">0</span>, progress <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/firatheme/man/theme_fira.html">theme_fira</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_colour_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Common swift nests"</span>, colour <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">plot_bird</span></code></pre></div>
<p><img src="advanced_enrichment_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div id="data-agumentation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-agumentation" class="anchor"></a>Data agumentation</h3>
<p>Once you know how the data look like, a necessary step, given the dataset at hand is proceeding with data augmentation. However, you need to make some assumptions about the position of the birds, in order to have a working model later on. Thus, you can assume that: - The data contains all nests within Utrecht (“the common swift inventarisation is comprehensive over the grid”). - You can randomly sample the data over 200 non-bird sites and assume that those are realistic non-bird sites (i.e. have 0 nests counts).</p>
<p>You will use these sites in the prediction of actual bird sites.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">45</span><span class="op">)</span>
<span class="va">bird_grid</span>  <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid</a></span><span class="op">(</span><span class="va">bird_sf</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span>
<span class="va">has_nests</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_contains</a></span><span class="op">(</span><span class="va">bird_grid</span>, <span class="va">bird_sf</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">any</span><span class="op">)</span>
<span class="va">zerosample</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">bird_grid</span><span class="op">[</span><span class="op">!</span><span class="va">has_nests</span><span class="op">]</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in st_centroid.sfc(sample(bird_grid[!has_nests], 200)): st_centroid does</span>
<span class="co">#&gt; not give correct centroids for longitude/latitude data</span>
<span class="va">nonbird_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">zerosample</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>nestcount <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">bird_sf</span>    <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">bird_sf</span>, <span class="va">nonbird_sf</span><span class="op">)</span></code></pre></div>
<p>Once you augmented the data following these assumptions, you can plot the augmented data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_bird</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nonbird_sf</span>, colour <span class="op">=</span> <span class="st">"black"</span>, bg <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1</span>, shape <span class="op">=</span> <span class="fl">22</span><span class="op">)</span></code></pre></div>
<p><img src="advanced_enrichment_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="data-enrichment" class="section level3">
<h3 class="hasAnchor">
<a href="#data-enrichment" class="anchor"></a>Data enrichment</h3>
<p>Moving to the data enrichment, you need to make another set of assumptions concerning the behavior of swifts within Utrecht. You will assume the following:</p>
<ul>
<li><p><strong>Nesting behaviour is spatially correlated</strong>. We are more likely to find a nest close to other nests.</p></li>
<li><p><strong>Common swifts benefit from commercial activity, but not too much</strong>. The birds need food but also they need peace. They are peaceful birds.</p></li>
<li><p><strong>Nature is important to the common swift</strong>. The birds need trees to do bird things like sitting and nesting.</p></li>
</ul>
<p>Given these assumptions, you can now use our package <code>osmenrich</code> to gather these data from sources such as OSM.</p>
<div id="use-osmenrich-for-computing-the-data-enrichment" class="section level4">
<h4 class="hasAnchor">
<a href="#use-osmenrich-for-computing-the-data-enrichment" class="anchor"></a>Use <code>osmenrich</code> for computing the data enrichment</h4>
<p>As stated above, you are now interested in retrieving a proxy of natural material availability and a proxy of commercial activity. For the sake of this example, you decide to retrieve trees and shops, as they represent a close enough proxy to natural materials and commercial activity.</p>
<p>To retrieve these OSM features, you will use the main function from <code>osmenrich</code>, <code><a href="../reference/enrich.html">enrich_osm()</a></code>. In the code below we retrieve shops and trees within a radius of 1km (r = 1000). If you are interested in retrieving other data points, please refer to the <a href="https://wiki.openstreetmap.org/wiki/Map_features">official list of available features</a> in OSM.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bird_sf</span> <span class="op">&lt;-</span>
  <span class="va">bird_sf</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"commercial_activity_1km"</span>,
    key <span class="op">=</span> <span class="st">"shop"</span>,
    kernel <span class="op">=</span> <span class="st">"gaussian"</span>,
    r <span class="op">=</span> <span class="fl">1000</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"tree_1km"</span>,
    key <span class="op">=</span> <span class="st">"natural"</span>,
    value <span class="op">=</span> <span class="st">"tree"</span>,
    kernel <span class="op">=</span> <span class="st">"gaussian"</span>,
    r <span class="op">=</span> <span class="fl">1000</span>
  <span class="op">)</span>
<span class="co">#&gt; ℹ Downloading data for commercial_activity_1km...</span>
<span class="co">#&gt; ✓ Downloaded data for commercial_activity_1km.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Downloaded 1494 points, 0 lines, 0 polygons, 0 mlines, 0 mpolygons.</span>
<span class="co">#&gt; ℹ Computing measure matrix for commercial_activity_1km...</span>
<span class="co">#&gt; ✓ Computed measure matrix for commercial_activity_1km.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Adding commercial_activity_1km to data.</span>
<span class="co">#&gt; ℹ Downloading data for tree_1km...</span>
<span class="co">#&gt; ✓ Downloaded data for tree_1km.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Downloaded 1923 points, 0 lines, 0 polygons, 0 mlines, 0 mpolygons.</span>
<span class="co">#&gt; ℹ Computing measure matrix for tree_1km...</span>
<span class="co">#&gt; ✓ Computed measure matrix for tree_1km.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Adding tree_1km to data.</span></code></pre></div>
<p>You also want to retrieve the same data points for a grid covering the bounding box of the data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_sf_c</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">bird_grid</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"commercial_activity_1km"</span>,
    key <span class="op">=</span> <span class="st">"shop"</span>,
    kernel <span class="op">=</span> <span class="st">"gaussian"</span>,
    r <span class="op">=</span> <span class="fl">1000</span>,
    .verbose <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"tree_1km"</span>,
    key <span class="op">=</span> <span class="st">"natural"</span>,
    value <span class="op">=</span> <span class="st">"tree"</span>,
    kernel <span class="op">=</span> <span class="st">"gaussian"</span>,
    r <span class="op">=</span> <span class="fl">1000</span>,
    .verbose <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning in st_centroid.sfc(bird_grid): st_centroid does not give correct</span>
<span class="co">#&gt; centroids for longitude/latitude data</span>
<span class="co">#&gt; ℹ Downloading data for commercial_activity_1km...</span>
<span class="co">#&gt; Request failed [429]. Retrying in 1 seconds...</span>
<span class="co">#&gt; ✓ Downloaded data for commercial_activity_1km.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Downloaded 1493 points, 0 lines, 0 polygons, 0 mlines, 0 mpolygons.</span>
<span class="co">#&gt; ℹ Computing measure matrix for commercial_activity_1km...</span>
<span class="co">#&gt; ✓ Computed measure matrix for commercial_activity_1km.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Adding commercial_activity_1km to data.</span>
<span class="co">#&gt; ℹ Downloading data for tree_1km...</span>
<span class="co">#&gt; ✓ Downloaded data for tree_1km.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Downloaded 1865 points, 0 lines, 0 polygons, 0 mlines, 0 mpolygons.</span>
<span class="co">#&gt; ℹ Computing measure matrix for tree_1km...</span>
<span class="co">#&gt; ✓ Computed measure matrix for tree_1km.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Adding tree_1km to data.</span></code></pre></div>
<p>And add the geometry to the grid, before plotting the results.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_sf_p</span> <span class="op">&lt;-</span> <span class="va">grid_sf_c</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_set_geometry</a></span><span class="op">(</span><span class="va">bird_grid</span><span class="op">)</span></code></pre></div>
</div>
<div id="plot-predictors-on-the-grid" class="section level4">
<h4 class="hasAnchor">
<a href="#plot-predictors-on-the-grid" class="anchor"></a>Plot predictors on the grid</h4>
<p>Plotting the results of the data enrichment, it is easy to identify the points on the map that represent the larger concetration of shops and trees.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_commercial_activity</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html">annotation_map_tile</a></span><span class="op">(</span>zoomin <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_sf_p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">commercial_activity_1km</span><span class="op">)</span>, colour <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bird_sf</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">nestcount</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/firatheme/man/theme_fira.html">theme_fira</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Commercial activity"</span>, fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_commercial_activity</span>
<span class="co">#&gt; Zoom: 14</span></code></pre></div>
<p><img src="advanced_enrichment_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_trees</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html">annotation_map_tile</a></span><span class="op">(</span>zoomin <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_sf_p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">tree_1km</span><span class="op">)</span>, colour <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bird_sf</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">nestcount</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/firatheme/man/theme_fira.html">theme_fira</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Trees"</span>, fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_trees</span>
<span class="co">#&gt; Zoom: 14</span></code></pre></div>
<p><img src="advanced_enrichment_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
</div>
<div id="modeling" class="section level3">
<h3 class="hasAnchor">
<a href="#modeling" class="anchor"></a>Modeling</h3>
<p>Now that you have the data, you can create a model to predict the presence of other nests. To model the data we will use a zero-inflated poisson spatial generalized additive model.</p>
<p>First, you need to define a function to turn <code>sf</code> with coordinates into a <code>df</code> with x and y.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_to_df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">bind_cols</span><span class="op">(</span>
    <span class="fu">as_tibble</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">geometry</span><span class="op">)</span>,
    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">sf</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">set_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Then, define a generalized additive model with <code>mgcv</code>. This is what we suggest using, but many other options are possible (gaussian process regression, regression kriging, other smoothing techniques, …).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span>
  <span class="va">nestcount</span> <span class="op">~</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html">te</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, bs <span class="op">=</span> <span class="st">"ts"</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># bivariate regularized thin plate spline</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">commercial_activity_1km</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="co"># quadratic effect of commercial activity</span>
    <span class="va">tree_1km</span>,                          <span class="co"># natural material availability proxy</span>
  family <span class="op">=</span> <span class="st">"ziP"</span>,                      <span class="co"># zero-inflated poisson</span>
  data <span class="op">=</span> <span class="fu">sf_to_df</span><span class="op">(</span><span class="va">bird_sf</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="interpretation-and-prediction" class="section level3">
<h3 class="hasAnchor">
<a href="#interpretation-and-prediction" class="anchor"></a>Interpretation and prediction</h3>
<p>To see the effects of spline, commercial activity, and natural material availability, simply call:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family: Zero inflated Poisson(1.672,0.844) </span>
<span class="co">#&gt; Link function: identity </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:</span>
<span class="co">#&gt; nestcount ~ te(x, y, bs = "ts") + poly(commercial_activity_1km, </span>
<span class="co">#&gt;     2) + tree_1km</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parametric coefficients:</span>
<span class="co">#&gt;                                   Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)                         -6.523      1.094  -5.963 2.47e-09 ***</span>
<span class="co">#&gt; poly(commercial_activity_1km, 2)1 -319.973    101.346  -3.157 0.001593 ** </span>
<span class="co">#&gt; poly(commercial_activity_1km, 2)2 -200.681     56.716  -3.538 0.000403 ***</span>
<span class="co">#&gt; tree_1km                           -27.490     16.178  -1.699 0.089269 .  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Approximate significance of smooth terms:</span>
<span class="co">#&gt;           edf Ref.df Chi.sq p-value    </span>
<span class="co">#&gt; te(x,y) 14.97     24  89.92  &lt;2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance explained = 91.1%</span>
<span class="co">#&gt; -REML = 165.51  Scale est. = 1         n = 299</span></code></pre></div>
<p>You can also plot the marginal effect of commercial activity and check that birds are negatively affected by too little shops in the area (not enough food?) as well as too many (too many people?).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.10</span>, <span class="fl">0.01</span><span class="op">)</span>
<span class="va">plot_marginal</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://strengejacke.github.io/ggeffects/reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">fit</span>, terms <span class="op">=</span> <span class="st">"commercial_activity_1km [values]"</span>,
            condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5.10</span>, y <span class="op">=</span> <span class="fl">52.125</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">predicted</span>, ymin <span class="op">=</span> <span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span>, fill <span class="op">=</span> <span class="va">firaCols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">firaCols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/firatheme/man/theme_fira.html">theme_fira</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Predicted nests"</span>, x <span class="op">=</span> <span class="st">"Commercial activity"</span>,
       title <span class="op">=</span> <span class="st">"Marginal effect of commercial activity"</span><span class="op">)</span>

<span class="va">plot_marginal</span></code></pre></div>
<p><img src="advanced_enrichment_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>Finally, you can create predictions over previously defined grid.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="fu">sf_to_df</span><span class="op">(</span><span class="va">grid_sf_c</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>And plot these predictions over the grid.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_sf_p</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="va">pred</span><span class="op">$</span><span class="va">fit</span>
<span class="va">grid_sf_p</span><span class="op">$</span><span class="va">se</span>   <span class="op">&lt;-</span> <span class="va">pred</span><span class="op">$</span><span class="va">se.fit</span>

<span class="va">plot_pred</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html">annotation_map_tile</a></span><span class="op">(</span>zoomin <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_sf_p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pred</span><span class="op">)</span>, colour <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bird_sf</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">nestcount</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/firatheme/man/theme_fira.html">theme_fira</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nest count"</span>, fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_pred</span>
<span class="co">#&gt; Zoom: 14</span></code></pre></div>
<p><img src="advanced_enrichment_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>If you are interested in the spline, you can also only plot the spline.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_sf_c2</span> <span class="op">&lt;-</span>
  <span class="va">grid_sf_c</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    commercial_activity_1km <span class="op">=</span> <span class="fl">0</span>,
    grass_300m <span class="op">=</span> <span class="fl">0</span>,
    tree_300m <span class="op">=</span> <span class="fl">0</span>
  <span class="op">)</span>

<span class="va">pred2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="fu">sf_to_df</span><span class="op">(</span><span class="va">grid_sf_c2</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">grid_sf_p</span><span class="op">$</span><span class="va">pred2</span> <span class="op">&lt;-</span> <span class="va">pred2</span><span class="op">$</span><span class="va">fit</span>

<span class="va">plot_pred_smooth_only</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html">annotation_map_tile</a></span><span class="op">(</span>zoomin <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_sf_p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pred2</span><span class="op">)</span>, colour <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bird_sf</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">nestcount</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/firatheme/man/theme_fira.html">theme_fira</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Spline-only predictions"</span>, fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_pred_smooth_only</span>
<span class="co">#&gt; Zoom: 14</span></code></pre></div>
<p><img src="advanced_enrichment_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
<div id="conclusion" class="section level3">
<h3 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h3>
<p>From this short example, you can conclude:</p>
<ul>
<li><p>Spatial observational data can be enriched easily using <code>sf</code> and <code>osmenrich</code></p></li>
<li><p>Spatial models can then be used to test expectations about behaviour in the environment</p></li>
<li><p>Spatial predictions from these models can guide future data collection efforts</p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://erikjanvankesteren.nl/">Erik-Jan van Kesteren</a>, <a href="https://leonardovida.com/">Leonardo Jaya Vida</a>, <a href="https://github.com/J535D165">Jonathan de Bruin</a>, <a href="https://odissei-data.nl/nl/soda/">SoDa Team</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
