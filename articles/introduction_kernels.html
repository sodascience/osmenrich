<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to kernels • osmenrich</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to kernels">
<meta property="og:description" content="Learn what are kernels and howto best use them to enrich your datasets.
">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">osmenrich</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/osmenrich.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sodascience/osmenrich">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction_kernels_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to kernels</h1>
                        <h4 class="author">SoDa Team</h4>
            
      
      
      <div class="hidden name"><code>introduction_kernels.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">osmenrich</span><span class="op">)</span></code></pre></div>
<div id="overview-of-kernels" class="section level2">
<h2 class="hasAnchor">
<a href="#overview-of-kernels" class="anchor"></a>Overview of kernels</h2>
<p>Kernels play a center role in data enrichment using <code>osmenrich</code>, as they are the tool to weight the features retrieved from OpenStreetMap (OSM). If you do not know OSM yet and the main functionality of this package, please refer to the introductory vignette.</p>
<p>In this short vignette, you will learn:</p>
<ul>
<li><p>What kernels are</p></li>
<li><p>How to use kernels to enrich your data using <code><a href="../reference/enrich.html">enrich_osm()</a></code></p></li>
<li><p>What the differences between types of kernels are</p></li>
<li><p>How to create your own kernel function</p></li>
</ul>
</div>
<div id="what-are-kernels" class="section level2">
<h2 class="hasAnchor">
<a href="#what-are-kernels" class="anchor"></a>What are kernels?</h2>
<p>Kernels are functions used to weight and “aggregate” features retrieved from OSM. Kernels are used in the main function of the <code>osmenrich</code> package, <code><a href="../reference/enrich.html">enrich_osm()</a></code>, using the variable <code>kernel = "&lt;name-kernel&gt;"</code> which allows you to specify the kernel function that will be used to summarize the features retrieved and it is shown in the example below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_data_enriched</span> <span class="op">&lt;-</span> <span class="va">sf_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    <span class="co"># [...]</span>
    kernel <span class="op">=</span> <span class="st">"uniform"</span>
    <span class="co"># [...]</span>
  <span class="op">)</span></code></pre></div>
<p>As kernels convert distance (or duration, depending on your necessity) vectors to single numbers, one can decide both the weight and the “aggregation” function to use to convert these vectors to a single number. The <code>osmenrich</code> package allows you to select both the kernel and the aggregation function used to reduce these vectors as follows:</p>
<ul>
<li><p><code>kernel =</code> can take the following inputs: <code>"uniform"</code> if, <code>"gaussian"</code> if, <code>"parabola"</code> if. This variable is set to <code>"uniform"</code> by default.</p></li>
<li><p><code>reduce_fun =</code> can be any aggregation (or reduction) function such as <code>sum</code>, <code>mean</code>, <code>median</code>, etc. This variable is set to <code>sum</code> by default.</p></li>
</ul>
<p>Thus, when choosing the kernel for your enrichment call, you usually will set these two variables as follows below</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>sf_data_enriched &lt;-<span class="st"> </span>sf_data <span class="op">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span><span class="kw">enrich_osm</span>(</span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="co"># [...]</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="dt">kernel =</span> <span class="st">"uniform"</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="dt">reduce_fun =</span> sum</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="co"># [...]</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>  )</span></code></pre></div>
<div id="kernels" class="section level3">
<h3 class="hasAnchor">
<a href="#kernels" class="anchor"></a>Kernels</h3>
<p>To make you understand the difference in the way the kernel weights the feature points retrieved in OSM, we plot the three main functions available in <code>osmenrich</code>. As you can see in the plot below, each kernels weights differently the features retrieved from OSM depending on the distance from the point of reference around which you are retrieving the points.</p>
<p><img src="introduction_kernels_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<ul>
<li><p>The <code>gaussian</code> kernel weights the features retrieved using the classical “bell curve” shape. The features on the border of the retrieved space are weighted zero.</p></li>
<li><p>The <code>parabola</code> kernel</p></li>
<li><p>Finally, the <code>uniform</code> kernel gives the same weight to all the features retrieved.</p></li>
</ul>
</div>
<div id="aggregation-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#aggregation-functions" class="anchor"></a>Aggregation functions</h3>
<p>As stated before, aggregation functions are fundamental when choosing how to aggregate data retrived from OSM. While kernel helps you weight the points retrieved by their distances from the reference points, the aggregation function performs the task of reducing the weighted points to a single value.</p>
<p>These aggregation functions, called <code>reduce_fun</code> in <code><a href="../reference/enrich.html">enrich_osm()</a></code>, take any standard R function. Therefore, if you just want to sum all the weighted points retrieved you will use <code>reduce_fun = sum</code>; if you instead want to take the mean of the retrieved points you will use <code>reduce_fun = mean</code>; for the median <code>reduce_fun = median</code> and so on…</p>
<p>Most of the time you will find yourself wanting to just <code>sum</code> the (un)weighted points retrieved, but keep in mind that you can also aggregate them using different functions.</p>
</div>
</div>
<div id="how-to-use-kernels" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-use-kernels" class="anchor"></a>How to use kernels</h2>
<p>In the examples above, you were introduced to the syntax needed to choose both the kernel and the aggregation (<code>reduce_fun</code>) function. Now, you will go through a basic example to see the differences between kernels.</p>
<p>Borrowing from the base example in our introductory vignette, you first create an example dataset to enrich <code>sf_example</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load packages used in this example, install if needed</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">osmenrich</span><span class="op">)</span>

<span class="co"># Create an example dataset to enrich</span>
<span class="va">sf_example</span> <span class="op">&lt;-</span>
  <span class="fu">tribble</span><span class="op">(</span>
    <span class="op">~</span><span class="va">person</span>,  <span class="op">~</span><span class="va">lat</span>,   <span class="op">~</span><span class="va">lon</span>,
    <span class="st">"Alice"</span>,  <span class="fl">52.12</span>,  <span class="fl">5.09</span>,
    <span class="st">"Bob"</span>,    <span class="fl">52.13</span>,  <span class="fl">5.08</span>,
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>
    coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>,
    crs <span class="op">=</span> <span class="fl">4326</span>
  <span class="op">)</span></code></pre></div>
<p>Once the <code>sf</code> dataset is created, you can enrich it using the base syntax:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_enriched_uniform</span> <span class="op">&lt;-</span> <span class="va">sf_example</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"n_waste_baskets"</span>,
    key <span class="op">=</span> <span class="st">"amenity"</span>,
    value <span class="op">=</span> <span class="st">"waste_basket"</span>,
    r <span class="op">=</span> <span class="fl">500</span>
  <span class="op">)</span></code></pre></div>
<p>Which, behind the scenes, sets automatically the kernel variable to <code>"uniform"</code> and the aggregation function to <code>sum</code>, as seen below.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_enriched_uniform</span> <span class="op">&lt;-</span> <span class="va">sf_example</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"n_waste_baskets"</span>,
    key <span class="op">=</span> <span class="st">"amenity"</span>,
    value <span class="op">=</span> <span class="st">"waste_basket"</span>,
    r <span class="op">=</span> <span class="fl">500</span>,
    <span class="co"># Default parameters now written out for clarity</span>
    kernel <span class="op">=</span> <span class="st">"uniform"</span>,
    reduce_fun <span class="op">=</span> <span class="va">sum</span>
  <span class="op">)</span>

<span class="va">sf_enriched_uniform</span>
<span class="co">#&gt; Simple feature collection with 2 features and 2 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 5.08 ymin: 52.12 xmax: 5.09 ymax: 52.13</span>
<span class="co">#&gt; CRS:           EPSG:4326</span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   person     geometry n_waste_baskets</span>
<span class="co">#&gt; * &lt;chr&gt;   &lt;POINT [°]&gt;           &lt;int&gt;</span>
<span class="co">#&gt; 1 Alice  (5.09 52.12)              75</span>
<span class="co">#&gt; 2 Bob    (5.08 52.13)               1</span></code></pre></div>
<div id="changing-the-kernel" class="section level3">
<h3 class="hasAnchor">
<a href="#changing-the-kernel" class="anchor"></a>Changing the kernel</h3>
<p>Taking as starting point the previous example, you can modify either the <code>"kernel"</code> variable or the <code>reduce_fun</code> variable to check the difference in the resulting aggregations.</p>
<p>Modify the <code>"kernel"</code> variable to <code>"gaussian"</code>, keeping the aggregation function to <code>sum</code>, and print the enriched dataset.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_enriched_gaussian</span> <span class="op">&lt;-</span> <span class="va">sf_example</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"n_waste_baskets"</span>,
    key <span class="op">=</span> <span class="st">"amenity"</span>,
    value <span class="op">=</span> <span class="st">"waste_basket"</span>,
    r <span class="op">=</span> <span class="fl">500</span>,
    <span class="co"># Default parameters now written out for clarity</span>
    kernel <span class="op">=</span> <span class="st">"gaussian"</span>,
    reduce_fun <span class="op">=</span> <span class="va">sum</span>
  <span class="op">)</span>

<span class="va">sf_enriched_gaussian</span>
<span class="co">#&gt; Simple feature collection with 2 features and 2 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 5.08 ymin: 52.12 xmax: 5.09 ymax: 52.13</span>
<span class="co">#&gt; CRS:           EPSG:4326</span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   person     geometry n_waste_baskets</span>
<span class="co">#&gt; * &lt;chr&gt;   &lt;POINT [°]&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Alice  (5.09 52.12)      0.0227    </span>
<span class="co">#&gt; 2 Bob    (5.08 52.13)      0.00000589</span></code></pre></div>
<p>The column <code>"n_waste_baskets"</code> provides the sum of the number of baskets weighted by the gaussian kernel. While when the kernel was <code>"uniform"</code> the waste baskets retrieved were weighted equally, now the with the kernel set to <code>"gaussian"</code> waste baskets are weighted in relation to their distance from the geometry of each person. The differences in results are not important in the context of this example, but the simplicity of the data enrichment is.</p>
</div>
<div id="plotting-kernels" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-kernels" class="anchor"></a>Plotting kernels</h3>
<p>We easily can visualize the circles of radius <code>r</code> (in this example r = 500) that are used to aggregate the features retrieved from OSM. As you can see in the image below, all the feature points within each circle will be weighted and aggregated using the <code>kernel</code> and <code>reduce_fun</code> specified in the <code><a href="../reference/enrich.html">enrich_osm()</a></code> call.</p>
<p><img src="introduction_kernels_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</div>
<div id="changing-the-aggregation-function" class="section level3">
<h3 class="hasAnchor">
<a href="#changing-the-aggregation-function" class="anchor"></a>Changing the aggregation function</h3>
<p>You can also easily change the aggregation function, by modifying the <code>reduce_fun</code> variable. As before, we take the previous example as starting point.</p>
<p>Let’s modify the<code>"reduce_fun"</code> to <code>"mean"</code>, change the name of the column accordingly, and print the result.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_enriched_uniform_mean</span> <span class="op">&lt;-</span> <span class="va">sf_example</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/enrich.html">enrich_osm</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"mean_waste_baskets"</span>,
    key <span class="op">=</span> <span class="st">"amenity"</span>,
    value <span class="op">=</span> <span class="st">"waste_basket"</span>,
    r <span class="op">=</span> <span class="fl">500</span>,
    kernel <span class="op">=</span> <span class="st">"uniform"</span>,
    <span class="co"># Modified aggregation function to mean</span>
    reduce_fun <span class="op">=</span> <span class="va">mean</span>
  <span class="op">)</span>

<span class="va">sf_enriched_uniform_mean</span>
<span class="co">#&gt; Simple feature collection with 2 features and 2 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 5.08 ymin: 52.12 xmax: 5.09 ymax: 52.13</span>
<span class="co">#&gt; CRS:           EPSG:4326</span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   person     geometry mean_waste_baskets</span>
<span class="co">#&gt; * &lt;chr&gt;   &lt;POINT [°]&gt;              &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Alice  (5.09 52.12)            0.510  </span>
<span class="co">#&gt; 2 Bob    (5.08 52.13)            0.00680</span></code></pre></div>
<p>Comparing it with the enriched dataset <code>sf_enriched_uniform</code> created before, you can see that the newly added column now reflects the metric chosen to aggregate the data (<code>mean</code> instead of <code>sum</code>).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://erikjanvankesteren.nl/">Erik-Jan van Kesteren</a>, <a href="https://leonardovida.com/">Leonardo Jaya Vida</a>, <a href="https://github.com/J535D165">Jonathan de Bruin</a>, <a href="https://odissei-data.nl/nl/soda/">SoDa Team</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
