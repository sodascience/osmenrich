<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Enrich sf object with OSM data — enrich • osmenrich</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Enrich sf object with OSM data — enrich" />
<meta property="og:description" content="Perform enriched query on OSM and add as new column." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">osmenrich</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/osmenrich.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sodascience/osmenrich">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Enrich <code>sf</code> object with OSM data</h1>
    
    <div class="hidden name"><code>enrich.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Perform enriched query on OSM and add as new column.</p>
    </div>

    <pre class="usage"><span class='fu'>enrich_osm</span><span class='op'>(</span>
  <span class='va'>dataset</span>,
  name <span class='op'>=</span> <span class='cn'>NULL</span>,
  key <span class='op'>=</span> <span class='cn'>NULL</span>,
  value <span class='op'>=</span> <span class='cn'>NULL</span>,
  type <span class='op'>=</span> <span class='st'>"points"</span>,
  measure <span class='op'>=</span> <span class='st'>"spherical"</span>,
  r <span class='op'>=</span> <span class='cn'>NULL</span>,
  kernel <span class='op'>=</span> <span class='st'>"uniform"</span>,
  reduce_fun <span class='op'>=</span> <span class='va'>sum</span>,
  control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  .verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='fu'>data_enrichment</span><span class='op'>(</span><span class='va'>ref_data</span>, <span class='va'>query</span>, <span class='va'>colname</span>, .verbose <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='fu'>measure_matrix</span><span class='op'>(</span><span class='va'>measure_name</span>, <span class='va'>measure_fun</span>, <span class='va'>ref_geometry</span>, <span class='va'>ftr_geometry</span><span class='op'>)</span>

<span class='fu'>control_enrich</span><span class='op'>(</span>timeout <span class='op'>=</span> <span class='fl'>300</span>, memsize <span class='op'>=</span> <span class='fl'>1073741824</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dataset</th>
      <td><p>target <code>sf</code> dataset to enrich with this package</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>the column name of the feature to be added</p></td>
    </tr>
    <tr>
      <th>key</th>
      <td><p>target OSM feature key to add, see <code><a href='https://docs.ropensci.org/osmdata/reference/add_osm_feature.html'>osmdata::add_osm_feature()</a></code></p></td>
    </tr>
    <tr>
      <th>value</th>
      <td><p>target value for OSM feature key to add, see
<code><a href='https://docs.ropensci.org/osmdata/reference/add_osm_feature.html'>osmdata::add_osm_feature()</a></code></p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p><code>character</code> the osm feature type or types to consider
(e.g., points, polygons), see details</p></td>
    </tr>
    <tr>
      <th>measure</th>
      <td><p><code>character</code> the measure metric used, see details</p></td>
    </tr>
    <tr>
      <th>r</th>
      <td><p>The search radius used by the <code>kernel</code> function.</p></td>
    </tr>
    <tr>
      <th>kernel</th>
      <td><p><code>function</code> the kernel function used, see details</p></td>
    </tr>
    <tr>
      <th>reduce_fun</th>
      <td><p>The aggregation function used by the <code>kernel</code> function to
aggregate the retrieved data objects</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>The list with configuration variables for the OSRM server.
It contains <code>timeout</code>, defining the number of seconds before the request
to OSRM times out, and <code>memsize</code>, defining the maximum size of the query to
OSRM.</p></td>
    </tr>
    <tr>
      <th>.verbose</th>
      <td><p><code>bool</code> whether to print info during enrichment</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional parameters to be passed into the OSM query, such as
a user-defined kernel.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>Type</code> represents the feature type to be considered. Usually this
would be points, but polygons and multipolygons are also possible. This
argument can also be a vector of multiple types. Non-point types will be
converted to points using the <code>st_centroid</code> function from the <code>sf</code> package
(NB this does not necessarily work well for all features!).
Available options are:</p><ul>
<li><p>points</p></li>
<li><p>lines</p></li>
<li><p>polygons</p></li>
<li><p>multilines</p></li>
<li><p>multipolygons</p></li>
</ul>

<p><code>Measure</code> represents the metric used to compute the distances or durations
between the rows in the dataset and the OSM features. The following metrics
are available in this package, assuming that the OSRM server is setup as
suggested in our guide at:
https://github.com/sodascience/osmenrich_docker:</p><ul>
<li><p>spherical</p></li>
<li><p>distance_by_foot</p></li>
<li><p>duration_by_foot</p></li>
<li><p>distance_by_car</p></li>
<li><p>duration_by_car</p></li>
<li><p>distance_by_bike</p></li>
<li><p>duration_by_bike</p></li>
</ul>

<p><code>Kernel</code> indicates the kernel function from the <code>osmenrich</code> package to be
used to weight the objects retrieved by their distances (or durations) from
the reference objects and then convert these vectors into single numbers.
The simplest kernel allows the user to count the number of occurrences
of reference objects within a radius <code>r</code> and is called <code>kernel_uniform</code>.</p>
<p>For more details see the introductory vignette of <code>osmenrich</code>:
<code>vignette("introduction", package = "osmenrich")</code></p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>If you want to get a large number of objects make sure to set the
<code>.timeout</code> (time before request times out) and <code>.memsize</code> (maxmimum
size of the request) arguments for the Overpass server and set
the "max-table-size" argument correctly when starting the
OSRM server(s).</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='enrich_opq.html'>enrich_opq()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># Load libraries</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span>

<span class='co'># Create example dataset</span>
<span class='va'>sf_example</span> <span class='op'>&lt;-</span>
<span class='fu'>tribble</span><span class='op'>(</span>
  <span class='op'>~</span><span class='va'>person</span>,  <span class='op'>~</span><span class='va'>lat</span>,   <span class='op'>~</span><span class='va'>lon</span>,
  <span class='st'>"Alice"</span>,  <span class='fl'>52.12</span>,  <span class='fl'>5.09</span>,
  <span class='st'>"Bob"</span>,    <span class='fl'>52.13</span>,  <span class='fl'>5.08</span>,
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_as_sf.html'>st_as_sf</a></span><span class='op'>(</span>
  coords <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"lon"</span>, <span class='st'>"lat"</span><span class='op'>)</span>,
  crs <span class='op'>=</span> <span class='fl'>4326</span>
 <span class='op'>)</span>

<span class='co'># Enrich data creating new column `waste_baskets`</span>
<span class='va'>sf_enriched</span> <span class='op'>&lt;-</span> <span class='va'>sf_example</span> <span class='op'>%&gt;%</span>
  <span class='fu'>enrich_osm</span><span class='op'>(</span>
    name <span class='op'>=</span> <span class='st'>"n_waste_baskets"</span>,
    key <span class='op'>=</span> <span class='st'>"amenity"</span>,
    value <span class='op'>=</span> <span class='st'>"waste_basket"</span>,
    reduce_fun <span class='op'>=</span> <span class='va'>sum</span>
  <span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://erikjanvankesteren.nl/'>Erik-Jan van Kesteren</a>, <a href='https://leonardovida.com/'>Leonardo Jaya Vida</a>, <a href='https://github.com/J535D165'>Jonathan de Bruin</a>, <a href='https://odissei-data.nl/nl/soda/'>SoDa Team</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


